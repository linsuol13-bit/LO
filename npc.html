<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NPC 상세</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
    .card { border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; padding:1rem; }
    .muted { color:#6b7280; }
    .thumb { width:96px; height:96px; object-fit:contain; border:1px solid #e5e7eb; border-radius:0.5rem; background:#fff; padding:8px; }
    .pill { font-size:12px; padding:.25rem .5rem; border:1px solid #e5e7eb; border-radius:999px; background:#fff; }
    a { color:#2563eb; }
  .map-box { display:inline-block; padding:0; border:1px solid #e5e7eb; border-radius:0.75rem; background:#fff; overflow:hidden; }
.map-head { padding:0.75rem 1rem; font-size:14px; font-weight:600; border-bottom:1px solid #f1f5f9; }
.map-img { display:block; width:100%; height:auto; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
  <a href="index.html?tab=npc" class="inline-flex items-center gap-1 text-sm mb-4 hover:underline">← NPC 목록으로</a>
  <article id="detail"></article>
</div>

<script>
(() => {
  'use strict';

  // 현재 요구사항: 넬라만 지원
  const NPCS = [
    {
      id: 'npc-nella',
      name: '넬라',
      place: '커닝시티',
      map: { id: 'map-kerning', name: '커닝시티', img: 'https://drive.google.com/thumbnail?id=1zPud0rosmJ7gIp6pDyPxAYq--p5vL3xN&sz=1700x668' },
      img: 'https://maplestory.io/api/KMS/338/npc/1052103/icon',
      quests: [
        { id:'2029', title:'마파의 의뢰', minLevel:15, link:'quest.html?id=2029' }
      ],

    }
  ];

  const byId = Object.fromEntries(NPCS.map(n=>[n.id,n]));
  const params = new URLSearchParams(location.search);
  const id = params.get('id') || 'npc-nella';
  const npc = byId[id] || NPCS[0];

  const $detail = document.getElementById('detail');
  const img = (src, alt, cls='') => src ? `<img src="${src}" alt="${alt}" ${cls?`class="${cls}"`:''} onerror="this.style.display='none'">` : '';

  const quests = (npc.quests||[]).map(q => `
    <a class="card flex items-center justify-between" href="${q.link||'#'}">
      <div>
        <div class="text-sm font-medium">${q.title}</div>
        <div class="text-xs muted">Lv.${q.minLevel||'-'}</div>
      </div>
      <span class="pill">#${q.id}</span>
    </a>
  `).join('') || '<div class="text-sm text-gray-500">진행 가능한 퀘스트가 없습니다.</div>';

  const mapBlock = npc.map
  ? `
      <a class="map-box inline-block" href="${npc.map.id ? `map.html?id=${npc.map.id}` : '#'}">
        <div class="map-head">${npc.map.name||'맵'}</div>
        ${npc.map.img ? `<img class="map-img" src="${npc.map.img}" alt="${npc.map.name}" onerror="this.style.display='none'">` : '<div class="text-xs muted p-3">이미지가 없습니다.</div>'}
      </a>
    `
  : '';

  $detail.innerHTML = `
    <header class="mb-4 flex items-center gap-4">
      ${img(npc.img, npc.name, 'thumb')}
      <div class="min-w-0">
        <h1 class="text-2xl font-bold">${npc.name}</h1><div class="text-sm muted">${npc.map && npc.map.id ? `<a href="map.html?id=${npc.map.id}" class="text-blue-600 hover:underline">${npc.place||"-"}</a>` : (npc.place||"-")}</div>
      </div>
    </header>

    <section class="grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2">
      <div>
        <h2 class="text-sm font-semibold mb-2">위치</h2>
        <div class="card text-sm">${npc.place||'-'}</div>
      </div>
      <div>
        <h2 class="text-sm font-semibold mb-2">진행하는 퀘스트</h2>
        <div class="grid gap-2">${quests}</div>
      </div>
      <div class="sm:col-span-2">
        <h2 class="text-sm font-semibold mb-2">맵</h2>
        ${mapBlock}
      </div>
    </section>
  `;
})();
</script>
</body>
</html>
