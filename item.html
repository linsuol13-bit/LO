<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Item Detail • 로나월드</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
  <a href="index.html?tab=items" class="inline-flex items-center gap-1 text-sm mb-3 text-blue-600 hover:underline">← 목록(아이템)으로</a>
  <article id="detail" class="border rounded-xl bg-white p-4"></article>
</div>
<script>
function safeImg(src, alt, cls){ if(!src) return ''; return `<img src="${src}" alt="${alt||''}" class="${cls||''}" onerror="this.style.display='none'">`; }
const SAMPLE = {
  items: [
    { id:'4000012', name:'초록버섯의 갓', type:'소재', category:'재료', desc:'초록버섯에서 얻는 갓.',
      img:'https://placehold.co/200x150?text=Cap' },
    { id:'2000006', name:'레몬', type:'소비', category:'소모품', desc:'체력을 회복.', img:'https://placehold.co/200x150?text=Lemon' }
  ],
  quests: [
    { id:'q-1', code:'넬라 1-1', title:'마파의 의뢰',
      reqItems:[{ itemId:'4000012', qty:50, name:'초록버섯의 갓'}],
      rewards:[{ itemId:'2000006', qty:50, name:'레몬'}, {exp:5600}]
    }
  ],
  monsters:[
    { id:'m-1', name:'초록버섯', level:10, img:'https://placehold.co/120x90?text=Green', drops:['4000012'] }
  ]
};
const params = new URLSearchParams(location.search);
const id = params.get('id')||'';
const it = SAMPLE.items.find(x=> x.id===id);
const qRequired = SAMPLE.quests.filter(q=> (q.reqItems||[]).some(r=> r.itemId===id));
const qRewarded = SAMPLE.quests.filter(q=> (q.rewards||[]).some(r=> r.itemId===id));
const mDroppers = (SAMPLE.monsters||[]).filter(m=> Array.isArray(m.drops) && m.drops.includes(id));

const detail = document.getElementById('detail');
if(!it){ detail.innerHTML = '<div class="p-6 text-center text-sm text-gray-500">아이템을 찾을 수 없어요</div>'; }
else {
  detail.innerHTML = `
  <div class="flex items-start gap-4">
    ${safeImg(it.img, it.name, 'w-28 h-28 object-contain rounded-lg border bg-white')}
    <div class="min-w-0">
      <h2 class="text-xl font-semibold">${it.name}</h2>
      <div class="text-xs text-gray-600">${it.category||it.type||'-'} · ${it.type||'-'}</div>
      ${ it.desc ? `<p class="text-sm text-gray-700 mt-2">${it.desc}</p>` : '' }
    </div>
  </div>

  <section class="mt-6">
    <h3 class="text-sm font-semibold mb-2">이 아이템이 필요한 퀘스트</h3>
    ${ qRequired.length ? qRequired.map(q=>`<a class="block text-sm text-blue-600 hover:underline" href="quest.html?id=${encodeURIComponent(q.id)}">${q.code ? q.code+' · ' : ''}${q.title}</a>`).join('') : '<div class="text-sm text-gray-500">없음</div>' }
  </section>

  <section class="mt-6">
    <h3 class="text-sm font-semibold mb-2">이 아이템을 주는 퀘스트</h3>
    ${ qRewarded.length ? qRewarded.map(q=>`<a class="block text-sm text-blue-600 hover:underline" href="quest.html?id=${encodeURIComponent(q.id)}">${q.code ? q.code+' · ' : ''}${q.title}</a>`).join('') : '<div class="text-sm text-gray-500">없음</div>' }
  </section>

  <section class="mt-6">
    <h3 class="text-sm font-semibold mb-2">이 아이템을 주는 몬스터</h3>
    ${ mDroppers.length ? (`<div class="grid grid-cols-1 sm:grid-cols-2 gap-3">` + mDroppers.map(m=>`
      <article class="flex items-center gap-3 rounded-lg border p-2 bg-white">
        ${safeImg(m.img, m.name, 'w-12 h-12 object-contain rounded-lg bg-white')}
        <div class="min-w-0">
          <div class="text-sm font-medium truncate">${m.name}</div>
          <div class="text-xs text-gray-600">Lv.${m.level||'-'}</div>
          <a href="monster.html?id=${encodeURIComponent(m.id)}" class="text-xs text-blue-600 hover:underline">몬스터 상세</a>
        </div>
      </article>`).join('') + `</div>`) : '<div class="text-sm text-gray-500">없음</div>' }
  </section>
  `;
}
</script>
</body>
</html>
