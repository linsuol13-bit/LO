<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quest Detail • 로나월드</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
    .rounded-xl{border-radius:0.75rem} .rounded-lg{border-radius:0.5rem}
    .border{border:1px solid #e5e7eb} .bg-white{background:#fff}
    .flex{display:flex} .items-center{align-items:center} .items-start{align-items:flex-start}
    .justify-center{justify-content:center} .gap-3{gap:0.75rem} .gap-4{gap:1rem}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-5xl p-4 sm:p-6 lg:p-8">
  <a href="index.html?tab=quests" class="inline-flex items-center gap-1 text-sm mb-4 text-blue-600 hover:underline">← 퀘스트 목록으로</a>
  <article id="detail"></article>
</div>

<script>
'use strict';

/* ================= Utils ================ */
function imgBox(src, alt, size){ // size: 16(64px) | 12(48px)
  const px = (size === 12) ? 48 : 64;
  const placeholder = "data:image/svg+xml;utf8," + encodeURIComponent(
    "<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'>"+
    "<rect x='3' y='3' width='18' height='18' rx='2' fill='none' stroke='%23D1D5DB'/>"+
    "<path d='M7 15l3-3 4 4 3-3 3 3' fill='none' stroke='%23D1D5DB'/></svg>"
  );
  const url = src ? String(src) : placeholder;
  return `<div class="rounded-lg border bg-white flex items-center justify-center overflow-hidden"
               style="width:${px}px;height:${px}px">
            <img src="${url}" alt="${alt||''}" loading="lazy"
                 style="max-width:100%;max-height:100%;object-fit:contain">
          </div>`;
}

/* ================= Images ================ */
const IMG = {
  nella: "https://drive.google.com/thumbnail?id=1oMpXQbJaijD-npUVu2JR7d-cF5_TgsjB&sz=w512",
  greenCap: "https://drive.google.com/thumbnail?id=1e09hggjXTuuCOxBWE2jILeGe7rpaft5a&sz=w512",
  lemon: "https://drive.google.com/thumbnail?id=1aIxoyI3w1lQkx4aGjX0OePhJmz0BNngw&sz=w512",
  bubbleDrop: "https://drive.google.com/thumbnail?id=1ZtmZq-lnEPVRCr1BSUV8eKlCkFgPHm95&sz=w512",
  victoria: "https://placehold.co/120x120?text=Victoria",
  kerning: "https://placehold.co/120x120?text=Kerning"
};

/* ================= Data ================== */
const quests = [{
  id: 'q-nella-1-1',
  code: '넬라 1-1',
  title: '마파의 의뢰',
  type: '아이템 수집',
  region: '빅토리아 아일랜드',
  minLevel: 15,
  start: { npc:{ name:'넬라', img:IMG.nella }, place:{ name:'커닝시티', img:IMG.kerning } },
  finish:{ npc:{ name:'넬라', img:IMG.nella }, place:{ name:'커닝시티', img:IMG.kerning } },
  reqItems:[
    { name:'초록버섯의 갓', qty:50, img:IMG.greenCap, itemId:'4000012' },
    { name:'버블링의 큰 방울', qty:50, img:IMG.bubbleDrop }
  ],
  rewards:[
    { name:'레몬', qty:50, img:IMG.lemon, itemId:'2000006' },
    { exp:5600 }
  ],
  dialogues:[
    { who:'넬라', text:'어머? 못보던 사람인걸? 내가 모르는걸 보니 이 마을 사람은 아닌 모양이지? 난 이마을의 정보통으로 통하는 넬라야. 이 마을에서 일어나는 여러가지 소식들을 빠짐없이 모두 알고 있지.' },
    { who:'넬라', text:'1000메소만 준다면 이 마을사람들의 여러 가지 정보를 모아서 너와 연결시켜 줄게. 그러니까 마을사람 중 누군가가 도움이 필요한 일이 있으면 너에게 소개시켜 준다는 말씀! 어때? 해볼래?' },
    { who:'넬라', text:'좋아! 1000 메소도 받았겠다. 약속은 지켜야 겠지? 우선 당장 급한 의뢰가 들어와 있으니 서둘러 주길 바래. 이 마을에서 방어구점을 운영하고 있는 마파 씨가 최근 새로운 방어구를 만들기 위해 독특한 재료를 모으고 있는 모양이야.' },
    { who:'라',   text:'초록버섯의 갓 50개와 버블링의 큰 방울 50개가 필요하다는데 너라면 이런것 모으는 것 쯤은 아무것도 아니겠지? 물론 사례는 섭섭하지 않을 정도로 해 준다고 약속했으니 걱정말라고. 그럼 모으는 대로 다시 나에게 돌아와 줘. 기다리고 있을게!' }
  ],
  completionDialogue:{ who:'넬라', text:'엇... 생각보다 빨리 돌아왔는걸? 역시 내가 사람보는 눈은 있다니까! 좋아! 이렇게 의뢰를 무사히 해결해 줬으니 사례를 해야겠지. 마파씨가 여행에 도움이 되라는 뜻에서 레몬을 잔뜩 맡기셨으니 받으라고~' }
}];

/* ============== Helpers ================ */
function speakerImage(name){
  if (name === '넬라') return IMG.nella;
  return '';
}
function duoRow(labelLeft, imgLeft, nameLeft, labelRight, imgRight, nameRight){
  return `<div class="flex items-center gap-4">
    <div class="flex items-center gap-3">
      ${imgBox(imgLeft, nameLeft, 16)}
      <div class="text-sm"><div class="text-gray-500">${labelLeft}</div><div class="font-medium">${nameLeft||'-'}</div></div>
    </div>
    <div class="text-gray-300">|</div>
    <div class="flex items-center gap-3">
      ${imgBox(imgRight, nameRight, 16)}
      <div class="text-sm"><div class="text-gray-500">${labelRight}</div><div class="font-medium">${nameRight||'-'}</div></div>
    </div>
  </div>`;
}
function reqItemView(r){
  const left = imgBox(r.img, r.name, 16);
  const title = `${r.name} ×${r.qty}`;
  if (r.itemId){
    return `<a class="flex items-center gap-3 group" href="item.html?id=${r.itemId}">
      ${left}
      <div class="min-w-0"><div class="text-sm font-medium text-blue-600 group-hover:underline">${title}</div></div>
    </a>`;
  }
  return `<div class="flex items-center gap-3">${left}<div class="min-w-0"><div class="text-sm font-medium">${title}</div></div></div>`;
}
function rewardView(r){
  if (typeof r.exp === 'number'){
    return `<div class="flex items-center gap-3">
      ${imgBox('', 'EXP', 16)}
      <div class="text-sm font-medium">경험치 ${r.exp.toLocaleString()} exp</div>
    </div>`;
  }
  const left = imgBox(r.img, r.name, 16);
  const title = `${r.name} ×${r.qty}`;
  if (r.itemId){
    return `<a class="flex items-center gap-3 group" href="item.html?id=${r.itemId}">
      ${left}
      <div class="min-w-0"><div class="text-sm font-medium text-blue-600 group-hover:underline">${title}</div></div>
    </a>`;
  }
  return `<div class="flex items-center gap-3">${left}<div class="text-sm font-medium">${title}</div></div>`;
}
function dialogueView(d){
  const sImg = speakerImage(d.who);
  return `<div class="flex items-start gap-3">
    ${imgBox(sImg, d.who, 16)}
    <div class="text-sm"><b>${d.who||''}:</b> ${d.text||''}</div>
  </div>`;
}

/* ============== Render ================== */
(function(){
  const $detail = document.getElementById('detail');
  const id = new URLSearchParams(location.search).get('id') || 'q-nella-1-1';
  let q = quests.find(x=> x.id===id);
  if (!q && quests.length){
    q = quests[0];
    history.replaceState({}, '', location.pathname + '?id=' + q.id);
  }
  if (!q){
    $detail.innerHTML = '<div class="p-6 text-center text-sm text-gray-500 bg-white rounded-xl border">퀘스트를 찾을 수 없습니다.</div>';
    return;
  }

  $detail.innerHTML = `
    <header class="mb-4">
      <h1 class="text-2xl font-bold">${q.code ? q.code + ' · ' : ''}${q.title}</h1>
      <p class="text-sm text-gray-600">${q.region||'-'} · ${q.type||'-'}${q.minLevel ? ' · Lv.'+q.minLevel : ''}</p>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="rounded-xl border bg-white p-4">
        <h2 class="text-sm font-semibold mb-3">시작</h2>
        ${duoRow('시작 NPC', q.start?.npc?.img, q.start?.npc?.name, '시작 장소', q.start?.place?.img, q.start?.place?.name)}
      </div>
      <div class="rounded-xl border bg-white p-4">
        <h2 class="text-sm font-semibold mb-3">완료</h2>
        ${duoRow('완료 NPC', q.finish?.npc?.img, q.finish?.npc?.name, '완료 장소', q.finish?.place?.img, q.finish?.place?.name)}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">대사</h2>
      <div class="rounded-xl border bg-white p-4 space-y-2">
        ${(q.dialogues||[]).map(dialogueView).join('')}
      </div>
    </section>

    <section class="mb-6">
      <h2 class="text-sm font-semibold mb-2">퀘스트 조건</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        ${(q.reqItems||[]).map(reqItemView).join('') || '<div class="text-sm text-gray-500">조건 없음</div>'}
      </div>
    </section>

    <section class="mb-4">
      <h2 class="text-sm font-semibold mb-2">완료 보상</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        ${(q.rewards||[]).map(rewardView).join('')}
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-sm font-semibold mb-2">완료 대사</h2>
      <div class="rounded-xl border bg-white p-4">
        ${dialogueView(q.completionDialogue||{})}
      </div>
    </section>
  `;
})();
</script>
</body>
</html>
