<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>로나월드 • 몬스터 • 퀘스트 • 아이템</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="mx-auto max-w-7xl p-4 sm:p-6 lg:p-8">
    <header class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">로나월드</h1>
        <p class="text-sm text-gray-500">몬스터 · 퀘스트 · 아이템</p>
      </div>
    </header>

    <!-- Controls (퀘스트 탭에서만 레벨 필터 노출) -->
    <section class="mb-4 border bg-white rounded-xl p-4">
      <div class="grid grid-cols-1 md:grid-cols-6 gap-3 items-end">
        <div class="md:col-span-2">
          <label class="text-xs text-gray-500">검색</label>
          <input id="searchInput" placeholder="이름/지역/설명" class="w-full rounded-lg border px-3 py-2" />
        </div>
        <div id="questLevelWrap" class="md:col-span-1 hidden">
          <label class="text-xs text-gray-500">내 레벨</label>
          <input id="playerLevel" type="number" inputmode="numeric" min="1" max="200"
                 placeholder="예: 120" class="w-full rounded-lg border px-3 py-2" />
          <p class="mt-1 text-[11px] text-gray-500">비워두면 모든 퀘스트 표시</p>
        </div>
        <div class="md:col-span-3 text-xs text-gray-500">
          <span class="block md:mt-6">Tip: 퀘스트 탭에서 “내 레벨”을 입력하면 <b>그 레벨 이상에서 시작 가능한 퀘스트</b>만 보입니다.</span>
        </div>
      </div>
    </section>

    <!-- Tabs -->
    <nav class="mb-4 inline-flex rounded-xl bg-white border p-1">
      <button data-tab="monsters" class="tab-btn px-3 py-2 text-sm rounded-lg text-gray-700">몬스터</button>
      <button data-tab="quests" class="tab-btn px-3 py-2 text-sm rounded-lg bg-gray-900 text-white">퀘스트</button>
      <button data-tab="items" class="tab-btn px-3 py-2 text-sm rounded-lg text-gray-700">아이템</button>
    </nav>

    <!-- Lists -->
    <section id="listMonsters" class="hidden grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>
    <section id="listQuests" class="grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>
    <section id="listItems" class="hidden grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>

    <footer class="mt-10 text-center text-xs text-gray-500">
      <hr class="my-4" />
      <p>© <span id="yy"></span> 로나월드</p>
    </footer>
  </div>

<script>
'use strict';

/* ===================== 샘플 데이터 ===================== */
window.monsters = [
  { id:'m-green-slime', name:'초록버섯', level:13, regions:['빅토리아'], img:'', drops:[{itemId:'4000012', name:'초록버섯의 갓'}] },
  { id:'m-bubbling',    name:'버블링',   level:15, regions:['커닝시티'], img:'', drops:[{name:'버블링의 큰 방울'}] }
];

window.quests = [
  { id:'q-nella-1-1', code:'넬라 1-1', title:'마파의 의뢰', type:'아이템 수집',
    region:'빅토리아 아일랜드', minLevel:15,
    summary:'초록버섯의 갓 50개, 버블링의 큰 방울 50개',
  },
  { id:'q-herb-2', code:'신입 2-1', title:'허브 채집', type:'아이템 수집',
    region:'엘리넬', minLevel:30,
    summary:'일반 허브 30개 모으기',
  },
  { id:'q-boss-1', code:'루더스 3-3', title:'루미너스 토벌', type:'보스',
    region:'루더스 레이크', minLevel:120,
    summary:'루미너스 처치',
  }
];

window.items = [
  { id:'4000012', name:'초록버섯의 갓', category:'재료', from:['초록버섯'], neededBy:['넬라 1-1'], gives:[] },
  { id:'2000006', name:'레몬', category:'소모품', from:['퀘스트 보상'], neededBy:[], gives:['넬라 1-1'] }
];

/* ===================== 공통 유틸 ===================== */
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
const fmtLv = (q) => 'Lv.' + (q.minLevel ?? 1);

/* ===================== 렌더러 ===================== */
function renderMonsters() {
  const q = $('#searchInput')?.value?.trim()?.toLowerCase() || '';
  const list = window.monsters.filter(m => {
    const t = (m.name + ' ' + (m.regions||[]).join(' ')).toLowerCase();
    return !q || t.includes(q);
  });
  $('#listMonsters').innerHTML = list.map(m => `
    <a href="monster.html?id=${m.id}" class="block rounded-xl border bg-white p-4 hover:bg-gray-50">
      <div class="text-xs text-gray-500">Lv.${m.level} · ${(m.regions||[]).join(', ')||'-'}</div>
      <div class="mt-1 font-semibold">${m.name}</div>
    </a>
  `).join('') || emptyCard('몬스터');
}

function renderQuests() {
  const q = $('#searchInput')?.value?.trim()?.toLowerCase() || '';
  const myLv = getPlayerLevel(); // null이면 전체
  const filtered = window.quests.filter(x => {
    const txt = (x.code + ' ' + x.title + ' ' + (x.region||'') + ' ' + (x.type||'') + ' ' + (x.summary||'')).toLowerCase();
    const textOk = !q || txt.includes(q);
    if (!textOk) return false;
    if (myLv == null) return true;        // 레벨 미입력 → 전체
    const min = x.minLevel ?? 1;
    return min <= myLv;                   // 내 레벨 이상에서 시작 가능한 퀘스트
  });
  $('#listQuests').innerHTML = filtered.map(x => `
    <a href="quest.html?id=${x.id}" class="block rounded-xl border bg-white p-4 hover:bg-gray-50">
      <div class="text-xs text-gray-500">${x.region||'-'} · ${x.type||'-'} · ${fmtLv(x)}</div>
      <div class="mt-1 font-semibold">${x.code ? x.code + ' · ' : ''}${x.title}</div>
      ${x.summary ? `<div class="mt-1 text-xs text-gray-600">${x.summary}</div>`:''}
    </a>
  `).join('') || emptyCard('퀘스트');
}

function renderItems() {
  const q = $('#searchInput')?.value?.trim()?.toLowerCase() || '';
  const list = window.items.filter(it => {
    const txt = (it.name + ' ' + (it.category||'') + ' ' + (it.from||[]).join(' ') + ' ' + (it.neededBy||[]).join(' ') + ' ' + (it.gives||[]).join(' ')).toLowerCase();
    return !q || txt.includes(q);
  });
  $('#listItems').innerHTML = list.map(it => `
    <a href="item.html?id=${it.id}" class="block rounded-xl border bg-white p-4 hover:bg-gray-50">
      <div class="text-xs text-gray-500">${it.category||'-'}</div>
      <div class="mt-1 font-semibold">${it.name}</div>
      <div class="mt-1 text-xs text-gray-600">획득처: ${(it.from||[]).join(', ')||'-'}</div>
      ${it.neededBy?.length ? `<div class="mt-1 text-[11px] text-gray-500">필요 퀘스트: ${it.neededBy.join(', ')}</div>`:''}
      ${it.gives?.length ? `<div class="mt-1 text-[11px] text-gray-500">보상 퀘스트: ${it.gives.join(', ')}</div>`:''}
    </a>
  `).join('') || emptyCard('아이템');
}

function emptyCard(label){
  return `<div class="text-sm text-gray-500 p-4 rounded-xl border bg-white">${label}가 없습니다.</div>`;
}

/* ===================== 레벨 필터 ===================== */
function getPlayerLevel(){
  const el = $('#playerLevel');
  if (!el) return null;
  const v = parseInt(el.value, 10);
  return Number.isFinite(v) ? v : null;
}

/* ===================== 탭/이벤트 ===================== */
function setActiveTab(tab){
  // 버튼 스타일
  $$('.tab-btn').forEach(b=>{
    if (b.dataset.tab===tab) {
      b.classList.add('bg-gray-900','text-white');
      b.classList.remove('text-gray-700');
    } else {
      b.classList.remove('bg-gray-900','text-white');
      b.classList.add('text-gray-700');
    }
  });
  // 섹션 표시
  $('#listMonsters').classList.toggle('hidden', tab!=='monsters');
  $('#listQuests').classList.toggle('hidden', tab!=='quests');
  $('#listItems').classList.toggle('hidden', tab!=='items');

  // 퀘스트 탭일 때만 레벨 입력칸 보이기
  $('#questLevelWrap').classList.toggle('hidden', tab!=='quests');

  // 렌더
  if (tab==='monsters') renderMonsters();
  if (tab==='quests')   renderQuests();
  if (tab==='items')    renderItems();

  // URL에 탭 보존
  const url = new URL(location.href);
  url.searchParams.set('tab', tab);
  history.replaceState({}, '', url.toString());
}

document.addEventListener('DOMContentLoaded', () => {
  // 초기 연도
  $('#yy').textContent = new Date().getFullYear();

  // 탭 버튼 바인딩
  $$('.tab-btn').forEach(b=>{
    b.addEventListener('click', ()=> setActiveTab(b.dataset.tab));
  });

  // 검색/레벨 입력 반응
  $('#searchInput').addEventListener('input', ()=>{
    const tab = new URL(location.href).searchParams.get('tab') || 'quests';
    if (tab==='monsters') renderMonsters();
    if (tab==='quests')   renderQuests();
    if (tab==='items')    renderItems();
  });
  const lvEl = $('#playerLevel');
  lvEl.addEventListener('input', renderQuests);

  // 초기 탭
  const initialTab = new URL(location.href).searchParams.get('tab') || 'quests';
  setActiveTab(initialTab);
});
</script>
</body>
</html>
