<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>로나월드 • Monsters • Items • Quests</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif; }
    input[type="range"]{ height:2px; }
    /* 카드 밑으로 컨트롤 링크 클릭이 새는 걸 방지 */
    .controls { position: relative; z-index: 20; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
<div class="mx-auto max-w-7xl p-4 sm:p-6 lg:p-8">
  <header class="mb-3 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">로나월드</h1>
      <p class="text-sm text-gray-500">몬스터 , 퀘스트 , 아이템</p>
    </div>
    <div class="flex items-center gap-2">
      <button id="resetBtn" class="rounded-lg bg-gray-900 text-white px-3 py-2 text-sm hover:bg-gray-800">초기화</button>
    </div>
  </header>

  <!-- Controls -->
  <section class="controls mb-4 border bg-white rounded-xl p-4">
    <div class="grid grid-cols-1 md:grid-cols-6 gap-3 items-end">
      <div class="md:col-span-2">
        <label class="text-xs text-gray-500">검색</label>
        <input id="searchInput" placeholder="이름/지역/아이템 검색" class="w-full rounded-lg border px-3 py-2" />
      </div>
      <div class="md:col-span-2">
        <label class="text-xs text-gray-500">지역</label>
        <select id="regionSelect" class="w-full rounded-lg border px-3 py-2"></select>
      </div>
      <div class="md:col-span-2">
        <label class="text-xs text-gray-500">레벨 범위</label>
        <div class="mt-2 flex items-center gap-2">
          <span id="lvMinBadge" class="text-xs px-2 py-1 rounded bg-gray-100 border">1</span>
          <input type="range" id="lvMinRange" min="1" max="200" step="1" value="1" class="w-full">
          <input type="range" id="lvMaxRange" min="1" max="200" step="1" value="200" class="w-full -ml-2">
          <span id="lvMaxBadge" class="text-xs px-2 py-1 rounded bg-gray-100 border">200</span>
        </div>
      </div>

      <!-- Items tab only -->
      <div id="itemTypeWrap" class="hidden md:col-span-2">
        <label class="text-xs text-gray-500">아이템 타입</label>
        <select id="typeSelect" class="w-full rounded-lg border px-3 py-2"></select>
      </div>

      <!-- Quests tab only -->
      <div id="questExpWrap" class="hidden md:col-span-2">
        <label class="text-xs text-gray-500">경험치 비율(이상)</label>
        <div class="mt-2 flex items-center gap-2">
          <span id="expRatioBadge" class="text-xs px-2 py-1 rounded bg-gray-100 border">0%</span>
          <input type="range" id="expRatioMinRange" min="0" max="100" step="5" value="0" class="w-full">
        </div>
      </div>
      <div id="playerLevelWrap" class="hidden md:col-span-2">
        <label class="text-xs text-gray-500">플레이어 레벨</label>
        <input id="playerLevelInput" type="number" min="1" max="200" value="100" class="w-full rounded-lg border px-3 py-2" />
      </div>
      <div id="expBucketWrap" class="hidden md:col-span-2">
        <label class="text-xs text-gray-500">경험치 통</label>
        <input id="expBucketInput" type="text" value="10,223,168" class="w-full rounded-lg border px-3 py-2" />
        <p id="bucketLabel" class="text-[11px] text-gray-500 mt-1">EXP 통: <span id="bucketLabelValue">10,223,168</span></p>
      </div>
    </div>
  </section>

  <!-- Tabs -->
  <nav class="mb-4 inline-flex rounded-xl bg-white border p-1">
    <button data-tab="monsters" class="tab-btn px-3 py-2 text-sm rounded-lg bg-gray-900 text-white">몬스터</button>
    <button data-tab="quests" class="tab-btn px-3 py-2 text-sm rounded-lg text-gray-700">퀘스트</button>
    <button data-tab="items" class="tab-btn px-3 py-2 text-sm rounded-lg text-gray-700">아이템</button>
  </nav>

  <!-- Lists -->
  <section id="listMonsters" class="grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>
  <section id="listQuests" class="hidden grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>
  <section id="listItems" class="hidden grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></section>

  <footer class="mt-10 text-center text-xs text-gray-500">
    <hr class="my-4" />
    <p>© <span id="yy"></span> 로나월드</p>
  </footer>
</div>

<script>
// --- Safe guards: avoid crashing if any element missing ---
(function(){
  'use strict';

  const $ = (id)=> document.getElementById(id);
  const $$ = (sel)=> Array.from(document.querySelectorAll(sel));

  const yy = $('yy'); if (yy) yy.textContent = new Date().getFullYear();
  function safeImg(src, alt, cls){ if(!src) return ''; return '<img src="'+src+'" alt="'+(alt||'')+'" class="'+(cls||'')+'" onerror="this.style.display=\'none\'">'; }
  function formatNumber(n){ n = Number(String(n).replace(/[^0-9.-]/g,''))||0; return n.toLocaleString(); }
  function uncomma(s){ return String(s||'').replace(/[^0-9]/g,''); }
  function sumQuestExp(q){ return (q.rewards||[]).reduce((a,r)=> a + (typeof r.exp==='number' ? r.exp : 0), 0); }
  function computeExpRatio(q, bucket){ const b = Number(bucket||0); if(!b) return 0; return Math.round((sumQuestExp(q)/b)*100); }

  // --- Data (minimal but valid) ---
  const EXP_TABLE = {1:15,2:34,3:57,4:92,5:135,6:372,7:560,8:840,9:1242,10:1716,11:2360,12:3216,13:4200,14:5460,15:7050,16:8840,17:11040,18:13716,19:16680,20:20216,21:24402,22:28980,23:34320,24:40512,25:47216,26:54900,27:63666,28:73080,29:83720,30:95700,31:108480,32:122760,33:138666,34:155540,35:174216,36:194832,37:216600,38:240500,39:266682,40:294216,41:324240,42:356916,43:391160,44:428280,45:468450,46:510420,47:555680,48:604416,49:655200,50:709716,51:748608,52:789631,53:832902,54:878545,55:926689,56:977471,57:1031036,58:1087536,59:1147132,60:1209994,61:1276301,62:1346242,63:1420016,64:1497832,65:1579913,66:1666492,67:1757815,68:1854143,69:1955750,70:2062925,71:2175973,72:2295216,73:2420993,74:2553663,75:2693603,76:2841212,77:2996910,78:3161140,79:3334370,80:3517093,81:3709829,82:3913127,83:4127566,84:4353756,85:4592341,86:4844001,87:5109452,88:5389449,89:5684790,90:5996316,91:6324914,92:6671519,93:7037118,94:7422752,95:7829518,96:8258575,97:8711144,98:9188514,99:9692044,100:10223168,101:10783397,102:11374327,103:11997640,104:12655110,105:13348610,106:14080113,107:14851703,108:15665576,109:16524049,110:17429566,111:18384706,112:19392187,113:20454878,114:21575805,115:22758159,116:24005306,117:25320796,118:26708375,119:28171993,120:29715818,121:31344244,122:33061908,123:34873700,124:36784778,125:38800583,126:40926854,127:43169645,128:45535341,129:48030677,130:50662758,131:53439077,132:56367538,133:59456479,134:62714694,135:66151459,136:69776558,137:73600313,138:77633610,139:81887931,140:86375389,141:91108760,142:96101520,143:101367883,144:106922842,145:112782213,146:118962678,147:125481832,148:132358236,149:139611467,150:147262175,151:155332142,152:163844343,153:172823012,154:182293713,155:192283408,156:202820538,157:213935103,158:225658746,159:238024845,160:251068606,161:264827165,162:279339693,163:294647508,164:310794191,165:327825712,166:345790561,167:364739883,168:384727628,169:405810702,170:428049128,171:451506220,172:476248760,173:502347192,174:529875818,175:558913012,176:589541445,177:621848316,178:655925603,179:691870326,180:729784819,181:769777027,182:811960808,183:856456260,184:903390063,185:952895838,186:1005114529,187:1060194805,188:1118293480,189:1179575962,190:1244216724,191:1312399800,192:1384319309,193:1460180007,194:1540197871,195:1624600714,196:1713628833,197:1807535693,198:1906588648,199:2011069705,200:2121276324 };

  const DATA = {
    monsters: [
      { id:'m-1', name:'초록버섯', level:10, region:'빅토리아 아일랜드', img:'https://placehold.co/200x150?text=Green+Mush' },
      { id:'m-2', name:'버블링', level:12, region:'빅토리아 아일랜드', img:'https://placehold.co/200x150?text=Bubble+Ring' }
    ],
    items: [
      { id:'4000012', name:'초록버섯의 갓', type:'소재', category:'재료', desc:'초록버섯에서 얻는 갓.', img:'https://placehold.co/200x150?text=Cap' },
      { id:'2000006', name:'레몬', type:'소비', category:'소모품', desc:'체력을 회복.', img:'https://placehold.co/200x150?text=Lemon' }
    ],
    quests: [
      { id:'q-1', code:'넬라 1-1', title:'마파의 의뢰', region:'빅토리아 아일랜드', type:'아이템수집', minLevel:15,
        npcImg:'https://placehold.co/80x80?text=NPC',
        rewards:[ { itemId:'2000006', qty:50, name:'레몬' }, { exp:5600 } ]
      }
    ]
  };

  // --- Elements ---
  const listMonsters = $('listMonsters');
  const listQuests = $('listQuests');
  const listItems = $('listItems');
  const searchInput = $('searchInput');
  const regionSelect = $('regionSelect');
  const lvMinRange = $('lvMinRange');
  const lvMaxRange = $('lvMaxRange');
  const lvMinBadge = $('lvMinBadge');
  const lvMaxBadge = $('lvMaxBadge');
  const itemTypeWrap = $('itemTypeWrap');
  const typeSelect = $('typeSelect');
  const questExpWrap = $('questExpWrap');
  const expRatioMinRange = $('expRatioMinRange');
  const expRatioBadge = $('expRatioBadge');
  const playerLevelWrap = $('playerLevelWrap');
  const playerLevelInput = $('playerLevelInput');
  const expBucketWrap = $('expBucketWrap');
  const expBucketInput = $('expBucketInput');
  const bucketLabelValue = $('bucketLabelValue');
  const tabs = $$('.tab-btn');

  // --- State ---
  let activeTab = 'monsters';
  let levelRange = [1,200];
  let expBucket = EXP_TABLE[100];
  let expRatioMin = 0;

  // --- Builders ---
  function buildRegions(){
    if(!regionSelect) return;
    const regs = new Set(['all']);
    (DATA.monsters||[]).forEach(m=> regs.add(m.region||''));
    (DATA.quests||[]).forEach(q=> regs.add(q.region||''));
    regionSelect.innerHTML = Array.from(regs).map(r=> '<option value="'+r+'">'+(r==='all'?'전체':r)+'</option>').join('');
    regionSelect.value = 'all';
  }
  function buildItemTypes(){
    if(!typeSelect) return;
    const types = new Set(['all']); (DATA.items||[]).forEach(i=> types.add(i.type||''));
    typeSelect.innerHTML = Array.from(types).map(t=> '<option value="'+t+'">'+(t==='all'?'전체':t)+'</option>').join('');
    typeSelect.value = 'all';
  }

  function applyActiveTabClasses(){
    tabs.forEach(b=>{
      const on = (b.getAttribute('data-tab') === activeTab);
      b.className = 'tab-btn px-3 py-2 text-sm rounded-lg ' + (on ? 'bg-gray-900 text-white' : 'text-gray-700');
    });
  }

  // --- Renderers ---
  function render(){
    const q = (searchInput && searchInput.value ? searchInput.value.trim() : '');
    const lvMin = levelRange[0], lvMax = levelRange[1];
    const region = regionSelect ? regionSelect.value : 'all';

    if(listMonsters) listMonsters.classList.toggle('hidden', activeTab!=='monsters');
    if(listQuests) listQuests.classList.toggle('hidden', activeTab!=='quests');
    if(listItems) listItems.classList.toggle('hidden', activeTab!=='items');
    if(itemTypeWrap) itemTypeWrap.classList.toggle('hidden', activeTab!=='items');
    if(questExpWrap) questExpWrap.classList.toggle('hidden', activeTab!=='quests');
    if(playerLevelWrap) playerLevelWrap.classList.toggle('hidden', activeTab!=='quests');
    if(expBucketWrap) expBucketWrap.classList.toggle('hidden', activeTab!=='quests');

    // Monsters
    if(activeTab==='monsters' && listMonsters){
      const data = (DATA.monsters||[]).filter(m=>{
        const hit = !q || m.name.includes(q) || (m.region||'').includes(q);
        const inRegion = region==='all' || (m.region||'').includes(region);
        const inLevel = (!m.level) || (m.level>=lvMin && m.level<=lvMax);
        return hit && inRegion && inLevel;
      });
      listMonsters.innerHTML = data.map(m=>(
        '<article class="rounded-xl border bg-white p-3 hover:shadow-sm transition">'+
          safeImg(m.img, m.name, 'w-full h-36 object-cover rounded-lg mb-2')+
          '<h3 class="font-semibold">'+m.name+'</h3>'+
          '<div class="text-xs text-gray-600">Lv.'+(m.level||'-')+' · '+(m.region||'-')+'</div>'+
          '<a href="monster.html?id='+encodeURIComponent(m.id)+'" class="inline-flex mt-2 text-sm text-blue-600 hover:underline">상세보기</a>'+
        '</article>'
      )).join('') || '<div class="text-sm text-gray-500 p-4">조건에 맞는 몬스터가 없습니다.</div>';
    }

    // Quests
    if(activeTab==='quests' && listQuests){
      const data = (DATA.quests||[]).filter(qs=>{
        const hit = !q || (qs.code&&qs.code.includes(q)) || (qs.title||'').includes(q) || (qs.region||'').includes(q);
        const inRegion = region==='all' || (qs.region||'').includes(region);
        const inLevel = (!qs.minLevel) || (qs.minLevel>=lvMin && qs.minLevel<=lvMax);
        const ratio = computeExpRatio(qs, expBucket);
        return hit && inRegion && inLevel && (ratio >= expRatioMin);
      });
      listQuests.innerHTML = data.map(qs=>{
        const exp = sumQuestExp(qs);
        const ratio = computeExpRatio(qs, expBucket);
        return (
          '<article class="rounded-xl border bg-white p-3 hover:shadow-sm transition">'+
            '<div class="flex items-start gap-3">'+
              safeImg(qs.npcImg, 'NPC', 'w-20 h-20 object-contain rounded-lg border bg-white')+
              '<div class="min-w-0">'+
                '<h3 class="font-semibold truncate">'+(qs.code ? qs.code+' · ' : '')+qs.title+'</h3>'+
                '<div class="flex items-center gap-2 text-xs text-gray-600 mb-1">'+
                  '<span>'+(qs.region||'-')+' · '+(qs.type||'-')+(qs.minLevel? ' · Lv.'+qs.minLevel : '')+'</span>'+
                  '<span class="text-[11px] px-2 py-0.5 rounded-full border bg-white">EXP '+exp.toLocaleString()+' · × '+ratio+'%</span>'+
                '</div>'+
                '<a href="quest.html?id=q-nella-1-1" class="inline-flex text-sm text-blue-600 hover:underline">상세보기</a>'+
              '</div>'+
            '</div>'+
          '</article>'
        );
      }).join('') || '<div class="text-sm text-gray-500 p-4">조건에 맞는 퀘스트가 없습니다.</div>';
    }

    // Items
    if(activeTab==='items' && listItems){
      const type = typeSelect ? typeSelect.value : 'all';
      const data = (DATA.items||[]).filter(it=>{
        const hit = !q || it.name.includes(q);
        const typeOk = type==='all' || (it.type===type);
        return hit && typeOk;
      });
      listItems.innerHTML = data.map(it=>(
        '<article class="rounded-xl border bg-white p-3 hover:shadow-sm transition">'+
          safeImg(it.img, it.name, 'w-full h-36 object-contain rounded-lg mb-2 bg-white')+
          '<h3 class="font-semibold">'+it.name+'</h3>'+
          '<div class="flex items-center gap-2 text-xs text-gray-600 mt-0.5">'+
            '<span class="px-2 py-0.5 rounded-full border bg-white">'+(it.category || it.type || '-')+'</span>'+
            '<span>'+(it.type||'-')+'</span>'+
          '</div>'+
          (it.desc ? '<p class="text-sm text-gray-700 mt-1">'+it.desc+'</p>' : '')+
          '<a href="item.html?id='+encodeURIComponent(it.id)+'" class="inline-flex mt-2 text-sm text-blue-600 hover:underline">상세보기</a>'+
        '</article>'
      )).join('') || '<div class="text-sm text-gray-500 p-4">조건에 맞는 아이템이 없습니다.</div>';
    }
  }

  // --- Events ---
  // 탭 클릭
  $$('.tab-btn').forEach(function(btn){
    btn.addEventListener('click', function(){
      activeTab = btn.getAttribute('data-tab');
      applyActiveTabClasses();
      render();
    });
  });

  // 필터들
  if(searchInput) searchInput.addEventListener('input', render);
  if(regionSelect) regionSelect.addEventListener('input', render);
  if(lvMinRange && lvMaxRange){
    function updateLv(){
      var min = Math.min(Number(lvMinRange.value)||1, Number(lvMaxRange.value)||1);
      var max = Math.max(Number(lvMinRange.value)||1, Number(lvMaxRange.value)||1);
      levelRange = [min, max];
      if(lvMinBadge) lvMinBadge.textContent = String(min);
      if(lvMaxBadge) lvMaxBadge.textContent = String(max);
      render();
    }
    lvMinRange.addEventListener('input', updateLv);
    lvMaxRange.addEventListener('input', updateLv);
  }
  if(typeSelect) typeSelect.addEventListener('change', render);
  if(expRatioMinRange){
    expRatioMinRange.addEventListener('input', function(){
      expRatioMin = Number(expRatioMinRange.value)||0;
      if(expRatioBadge) expRatioBadge.textContent = expRatioMin + '%';
      render();
    });
  }
  if(playerLevelInput){
    playerLevelInput.addEventListener('input', function(){
      var lv = Math.max(1, Math.min(200, Number(playerLevelInput.value)||100));
      if(EXP_TABLE.hasOwnProperty(lv)) expBucket = EXP_TABLE[lv];
      if(expBucketInput) expBucketInput.value = formatNumber(expBucket);
      if(bucketLabelValue) bucketLabelValue.textContent = (expBucket||0).toLocaleString();
      render();
    });
  }
  if(expBucketInput){
    expBucketInput.addEventListener('input', function(){
      var raw = uncomma(expBucketInput.value);
      expBucket = Math.max(1, Number(raw)||1);
      expBucketInput.value = formatNumber(expBucket);
      if(bucketLabelValue) bucketLabelValue.textContent = (expBucket||0).toLocaleString();
      render();
    });
  }

  // 초기화 버튼
  const resetBtn = $('resetBtn');
  if(resetBtn){
    resetBtn.addEventListener('click', function(){
      if(searchInput) searchInput.value='';
      if(regionSelect) regionSelect.value='all';
      if(lvMinRange && lvMaxRange){ lvMinRange.value=1; lvMaxRange.value=200; levelRange=[1,200]; if(lvMinBadge) lvMinBadge.textContent='1'; if(lvMaxBadge) lvMaxBadge.textContent='200'; }
      if(typeSelect) typeSelect.value='all';
      if(expRatioMinRange){ expRatioMinRange.value=0; expRatioMin=0; if(expRatioBadge) expRatioBadge.textContent='0%'; }
      if(playerLevelInput){ playerLevelInput.value=100; expBucket = EXP_TABLE[100]; }
      if(expBucketInput) expBucketInput.value = formatNumber(expBucket);
      if(bucketLabelValue) bucketLabelValue.textContent = (expBucket||0).toLocaleString();
      activeTab='monsters'; applyActiveTabClasses(); render();
    });
  }

  // --- Init ---
  (function init(){
    buildRegions();
    buildItemTypes();
    if(expBucketInput) expBucketInput.value = formatNumber(expBucket);
    if(bucketLabelValue) bucketLabelValue.textContent = (expBucket||0).toLocaleString();
    // 탭 표시 적용 후 첫 렌더
    applyActiveTabClasses();
    render();
  })();

})(); // IIFE
</script>
</body>
</html>
